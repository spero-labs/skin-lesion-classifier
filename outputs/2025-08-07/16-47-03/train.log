[2025-08-07 16:47:03,396][training][INFO] - Configuration:
[2025-08-07 16:47:03,398][training][INFO] - data:
  data_dir: HAM10000
  metadata_path: HAM10000/HAM10000_metadata.csv
  image_size: 224
  batch_size: 32
  num_workers: 0
  val_split: 0.15
  test_split: 0.15
  use_metadata: false
  use_weighted_sampling: true
  seed: 42
model:
  architecture: efficientnet_b0
  pretrained: true
  num_classes: 7
  dropout: 0.3
  use_metadata: false
training:
  epochs: 50
  learning_rate: 0.001
  weight_decay: 0.0001
  optimizer: adamw
  scheduler: cosine
  early_stopping_patience: 10
  gradient_clip_val: 1.0
  loss: focal
experiment:
  name: baseline_efficientnet_b0
  project_name: skin-lesion-classification
  seed: 42
  device: mps
  use_wandb: false
  checkpoint_dir: checkpoints
inference:
  tta_enabled: true
  tta_transforms: 5
  confidence_threshold: 0.7
  batch_size: 32
advanced:
  use_ensemble: false
  ensemble_models:
  - efficientnet_b0
  - efficientnet_b1
  - resnet50
  ensemble_weights: null
targets:
  min_val_auc: 0.9
  min_val_accuracy: 0.85
  max_inference_time_ms: 100
  max_model_size_mb: 50

[2025-08-07 16:47:03,398][training][INFO] - Setting up data module...
[2025-08-07 16:47:03,420][src.data.dataset][INFO] - Data splits - Train: 7009, Val: 1503, Test: 1503
[2025-08-07 16:47:03,432][src.data.dataset][INFO] - Class mapping: {'akiec': 0, 'bcc': 1, 'bkl': 2, 'df': 3, 'mel': 4, 'nv': 5, 'vasc': 6}
[2025-08-07 16:47:03,587][src.data.dataset][INFO] - Loaded 7009 images for train set
[2025-08-07 16:47:03,588][src.data.dataset][INFO] - Class distribution: {'nv': 4693, 'mel': 779, 'bkl': 769, 'bcc': 360, 'akiec': 229, 'vasc': 99, 'df': 80}
[2025-08-07 16:47:03,627][src.data.dataset][INFO] - Loaded 1503 images for val set
[2025-08-07 16:47:03,628][src.data.dataset][INFO] - Class distribution: {'nv': 1006, 'mel': 167, 'bkl': 165, 'bcc': 77, 'akiec': 49, 'vasc': 21, 'df': 18}
[2025-08-07 16:47:03,667][src.data.dataset][INFO] - Loaded 1503 images for test set
[2025-08-07 16:47:03,667][src.data.dataset][INFO] - Class distribution: {'nv': 1006, 'mel': 167, 'bkl': 165, 'bcc': 77, 'akiec': 49, 'vasc': 22, 'df': 17}
[2025-08-07 16:47:03,667][src.data.dataloader][INFO] - Dataset setup complete. Classes: 7
[2025-08-07 16:47:03,667][training][INFO] - Creating model: efficientnet_b0
[2025-08-07 16:47:03,713][timm.models._builder][INFO] - Loading pretrained weights from Hugging Face hub (timm/efficientnet_b0.ra_in1k)
[2025-08-07 16:47:03,837][timm.models._hub][INFO] - [timm/efficientnet_b0.ra_in1k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
[2025-08-07 16:47:03,866][src.models.model_factory][INFO] - Created efficientnet_b0 model with 7 classes
[2025-08-07 16:47:03,866][src.models.model_factory][INFO] - Model parameters: 5,618,564
[2025-08-07 16:47:03,867][src.models.model_factory][INFO] - Trainable parameters: 5,618,564
[2025-08-07 16:47:03,944][training][INFO] - Starting training...
[2025-08-07 16:47:04,045][src.training.trainer][INFO] - Starting training...
[2025-08-07 16:47:04,045][src.training.trainer][INFO] - Device: mps
[2025-08-07 16:47:04,046][src.training.trainer][INFO] - Model parameters: 5,618,564
[2025-08-07 16:47:04,046][src.training.trainer][INFO] - 
==================================================
[2025-08-07 16:47:04,046][src.training.trainer][INFO] - Epoch 1/50
[2025-08-07 16:48:17,444][src.training.trainer][INFO] - Train - Loss: 0.7193, Acc: 0.5651, AUC: 0.8778
[2025-08-07 16:48:17,445][src.training.trainer][INFO] - Val - Loss: 0.3788, Acc: 0.7438, AUC: 0.9316
[2025-08-07 16:48:17,445][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 16:48:17,445][src.training.callbacks][INFO] - Learning rate: 9.99e-05
[2025-08-07 16:48:17,445][src.training.callbacks][INFO] - EarlyStopping: Initial best score = 0.9316
[2025-08-07 16:48:17,445][src.training.trainer][INFO] - New best validation AUC: 0.9316
[2025-08-07 16:48:17,445][src.training.trainer][INFO] - 
==================================================
[2025-08-07 16:48:17,445][src.training.trainer][INFO] - Epoch 2/50
[2025-08-07 16:49:29,729][src.training.trainer][INFO] - Train - Loss: 0.4553, Acc: 0.7012, AUC: 0.9365
[2025-08-07 16:49:29,731][src.training.trainer][INFO] - Val - Loss: 0.3769, Acc: 0.7239, AUC: 0.9519
[2025-08-07 16:49:29,731][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 16:49:29,731][src.training.callbacks][INFO] - Learning rate: 9.96e-05
[2025-08-07 16:49:29,731][src.training.callbacks][INFO] - EarlyStopping: New best score = 0.9519
[2025-08-07 16:49:29,731][src.training.trainer][INFO] - New best validation AUC: 0.9519
[2025-08-07 16:49:29,731][src.training.trainer][INFO] - 
==================================================
[2025-08-07 16:49:29,731][src.training.trainer][INFO] - Epoch 3/50
[2025-08-07 16:50:43,413][src.training.trainer][INFO] - Train - Loss: 0.3809, Acc: 0.7376, AUC: 0.9505
[2025-08-07 16:50:43,413][src.training.trainer][INFO] - Val - Loss: 0.3577, Acc: 0.6860, AUC: 0.9500
[2025-08-07 16:50:43,413][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 16:50:43,413][src.training.callbacks][INFO] - Learning rate: 9.91e-05
[2025-08-07 16:50:43,413][src.training.callbacks][INFO] - EarlyStopping: No improvement for 1 epochs
[2025-08-07 16:50:43,413][src.training.trainer][INFO] - 
==================================================
[2025-08-07 16:50:43,413][src.training.trainer][INFO] - Epoch 4/50
[2025-08-07 16:51:55,887][src.training.trainer][INFO] - Train - Loss: 0.3258, Acc: 0.7581, AUC: 0.9606
[2025-08-07 16:51:55,887][src.training.trainer][INFO] - Val - Loss: 0.3005, Acc: 0.7631, AUC: 0.9616
[2025-08-07 16:51:55,888][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 16:51:55,888][src.training.callbacks][INFO] - Learning rate: 9.84e-05
[2025-08-07 16:51:55,888][src.training.callbacks][INFO] - EarlyStopping: New best score = 0.9616
[2025-08-07 16:51:55,888][src.training.trainer][INFO] - New best validation AUC: 0.9616
[2025-08-07 16:51:55,888][src.training.trainer][INFO] - 
==================================================
[2025-08-07 16:51:55,888][src.training.trainer][INFO] - Epoch 5/50
[2025-08-07 16:53:09,523][src.training.trainer][INFO] - Train - Loss: 0.3014, Acc: 0.7815, AUC: 0.9640
[2025-08-07 16:53:09,523][src.training.trainer][INFO] - Val - Loss: 0.2351, Acc: 0.7851, AUC: 0.9638
[2025-08-07 16:53:09,523][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 16:53:09,523][src.training.callbacks][INFO] - Learning rate: 9.76e-05
[2025-08-07 16:53:09,523][src.training.callbacks][INFO] - EarlyStopping: New best score = 0.9638
[2025-08-07 16:53:09,523][src.training.trainer][INFO] - New best validation AUC: 0.9638
[2025-08-07 16:53:09,523][src.training.trainer][INFO] - 
==================================================
[2025-08-07 16:53:09,523][src.training.trainer][INFO] - Epoch 6/50
[2025-08-07 16:54:20,508][src.training.trainer][INFO] - Train - Loss: 0.2599, Acc: 0.7988, AUC: 0.9708
[2025-08-07 16:54:20,508][src.training.trainer][INFO] - Val - Loss: 0.2384, Acc: 0.8137, AUC: 0.9690
[2025-08-07 16:54:20,508][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 16:54:20,508][src.training.callbacks][INFO] - Learning rate: 9.65e-05
[2025-08-07 16:54:20,508][src.training.callbacks][INFO] - EarlyStopping: New best score = 0.9690
[2025-08-07 16:54:20,508][src.training.trainer][INFO] - New best validation AUC: 0.9690
[2025-08-07 16:54:20,508][src.training.trainer][INFO] - 
==================================================
[2025-08-07 16:54:20,508][src.training.trainer][INFO] - Epoch 7/50
[2025-08-07 16:55:30,058][src.training.trainer][INFO] - Train - Loss: 0.2402, Acc: 0.8078, AUC: 0.9740
[2025-08-07 16:55:30,058][src.training.trainer][INFO] - Val - Loss: 0.2514, Acc: 0.7565, AUC: 0.9681
[2025-08-07 16:55:30,058][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 16:55:30,058][src.training.callbacks][INFO] - Learning rate: 9.53e-05
[2025-08-07 16:55:30,058][src.training.callbacks][INFO] - EarlyStopping: No improvement for 1 epochs
[2025-08-07 16:55:30,058][src.training.trainer][INFO] - 
==================================================
[2025-08-07 16:55:30,058][src.training.trainer][INFO] - Epoch 8/50
[2025-08-07 16:56:39,599][src.training.trainer][INFO] - Train - Loss: 0.2206, Acc: 0.8343, AUC: 0.9773
[2025-08-07 16:56:39,599][src.training.trainer][INFO] - Val - Loss: 0.2008, Acc: 0.8370, AUC: 0.9704
[2025-08-07 16:56:39,599][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 16:56:39,599][src.training.callbacks][INFO] - Learning rate: 9.39e-05
[2025-08-07 16:56:39,599][src.training.callbacks][INFO] - EarlyStopping: New best score = 0.9704
[2025-08-07 16:56:39,599][src.training.trainer][INFO] - New best validation AUC: 0.9704
[2025-08-07 16:56:39,599][src.training.trainer][INFO] - 
==================================================
[2025-08-07 16:56:39,599][src.training.trainer][INFO] - Epoch 9/50
[2025-08-07 16:57:49,615][src.training.trainer][INFO] - Train - Loss: 0.2104, Acc: 0.8332, AUC: 0.9788
[2025-08-07 16:57:49,617][src.training.trainer][INFO] - Val - Loss: 0.2037, Acc: 0.8303, AUC: 0.9731
[2025-08-07 16:57:49,618][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 16:57:49,618][src.training.callbacks][INFO] - Learning rate: 9.23e-05
[2025-08-07 16:57:49,618][src.training.callbacks][INFO] - EarlyStopping: New best score = 0.9731
[2025-08-07 16:57:49,618][src.training.trainer][INFO] - New best validation AUC: 0.9731
[2025-08-07 16:57:49,618][src.training.trainer][INFO] - 
==================================================
[2025-08-07 16:57:49,618][src.training.trainer][INFO] - Epoch 10/50
[2025-08-07 16:58:59,448][src.training.trainer][INFO] - Train - Loss: 0.1921, Acc: 0.8479, AUC: 0.9824
[2025-08-07 16:58:59,449][src.training.trainer][INFO] - Val - Loss: 0.2126, Acc: 0.8270, AUC: 0.9753
[2025-08-07 16:58:59,449][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 16:58:59,449][src.training.callbacks][INFO] - Learning rate: 9.05e-05
[2025-08-07 16:58:59,449][src.training.callbacks][INFO] - EarlyStopping: New best score = 0.9753
[2025-08-07 16:58:59,449][src.training.trainer][INFO] - New best validation AUC: 0.9753
[2025-08-07 16:58:59,449][src.training.trainer][INFO] - 
==================================================
[2025-08-07 16:58:59,449][src.training.trainer][INFO] - Epoch 11/50
[2025-08-07 17:00:09,055][src.training.trainer][INFO] - Train - Loss: 0.1789, Acc: 0.8540, AUC: 0.9833
[2025-08-07 17:00:09,056][src.training.trainer][INFO] - Val - Loss: 0.2135, Acc: 0.7997, AUC: 0.9719
[2025-08-07 17:00:09,056][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 17:00:09,056][src.training.callbacks][INFO] - Learning rate: 8.86e-05
[2025-08-07 17:00:09,056][src.training.callbacks][INFO] - EarlyStopping: No improvement for 1 epochs
[2025-08-07 17:00:09,056][src.training.trainer][INFO] - 
==================================================
[2025-08-07 17:00:09,056][src.training.trainer][INFO] - Epoch 12/50
[2025-08-07 17:01:18,768][src.training.trainer][INFO] - Train - Loss: 0.1826, Acc: 0.8570, AUC: 0.9834
[2025-08-07 17:01:18,768][src.training.trainer][INFO] - Val - Loss: 0.1950, Acc: 0.8310, AUC: 0.9745
[2025-08-07 17:01:18,768][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 17:01:18,768][src.training.callbacks][INFO] - Learning rate: 8.66e-05
[2025-08-07 17:01:18,769][src.training.callbacks][INFO] - EarlyStopping: No improvement for 2 epochs
[2025-08-07 17:01:18,769][src.training.trainer][INFO] - 
==================================================
[2025-08-07 17:01:18,769][src.training.trainer][INFO] - Epoch 13/50
[2025-08-07 17:02:28,251][src.training.trainer][INFO] - Train - Loss: 0.1722, Acc: 0.8604, AUC: 0.9844
[2025-08-07 17:02:28,252][src.training.trainer][INFO] - Val - Loss: 0.2148, Acc: 0.8097, AUC: 0.9725
[2025-08-07 17:02:28,252][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 17:02:28,252][src.training.callbacks][INFO] - Learning rate: 8.44e-05
[2025-08-07 17:02:28,252][src.training.callbacks][INFO] - EarlyStopping: No improvement for 3 epochs
[2025-08-07 17:02:28,252][src.training.trainer][INFO] - 
==================================================
[2025-08-07 17:02:28,252][src.training.trainer][INFO] - Epoch 14/50
[2025-08-07 17:03:38,441][src.training.trainer][INFO] - Train - Loss: 0.1632, Acc: 0.8744, AUC: 0.9857
[2025-08-07 17:03:38,445][src.training.trainer][INFO] - Val - Loss: 0.2034, Acc: 0.8230, AUC: 0.9747
[2025-08-07 17:03:38,445][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 17:03:38,445][src.training.callbacks][INFO] - Learning rate: 8.21e-05
[2025-08-07 17:03:38,445][src.training.callbacks][INFO] - EarlyStopping: No improvement for 4 epochs
[2025-08-07 17:03:38,445][src.training.trainer][INFO] - 
==================================================
[2025-08-07 17:03:38,445][src.training.trainer][INFO] - Epoch 15/50
[2025-08-07 17:04:48,124][src.training.trainer][INFO] - Train - Loss: 0.1413, Acc: 0.8840, AUC: 0.9887
[2025-08-07 17:04:48,125][src.training.trainer][INFO] - Val - Loss: 0.1666, Acc: 0.8723, AUC: 0.9774
[2025-08-07 17:04:48,125][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 17:04:48,125][src.training.callbacks][INFO] - Learning rate: 7.96e-05
[2025-08-07 17:04:48,125][src.training.callbacks][INFO] - EarlyStopping: New best score = 0.9774
[2025-08-07 17:04:48,125][src.training.trainer][INFO] - New best validation AUC: 0.9774
[2025-08-07 17:04:48,125][src.training.trainer][INFO] - 
==================================================
[2025-08-07 17:04:48,125][src.training.trainer][INFO] - Epoch 16/50
[2025-08-07 17:05:57,774][src.training.trainer][INFO] - Train - Loss: 0.1373, Acc: 0.8873, AUC: 0.9894
[2025-08-07 17:05:57,775][src.training.trainer][INFO] - Val - Loss: 0.1973, Acc: 0.8250, AUC: 0.9762
[2025-08-07 17:05:57,775][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 17:05:57,775][src.training.callbacks][INFO] - Learning rate: 7.70e-05
[2025-08-07 17:05:57,775][src.training.callbacks][INFO] - EarlyStopping: No improvement for 1 epochs
[2025-08-07 17:05:57,775][src.training.trainer][INFO] - 
==================================================
[2025-08-07 17:05:57,775][src.training.trainer][INFO] - Epoch 17/50
[2025-08-07 17:07:07,525][src.training.trainer][INFO] - Train - Loss: 0.1497, Acc: 0.8820, AUC: 0.9881
[2025-08-07 17:07:07,525][src.training.trainer][INFO] - Val - Loss: 0.1821, Acc: 0.8663, AUC: 0.9776
[2025-08-07 17:07:07,525][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 17:07:07,525][src.training.callbacks][INFO] - Learning rate: 7.43e-05
[2025-08-07 17:07:07,525][src.training.callbacks][INFO] - EarlyStopping: New best score = 0.9776
[2025-08-07 17:07:07,525][src.training.trainer][INFO] - New best validation AUC: 0.9776
[2025-08-07 17:07:07,525][src.training.trainer][INFO] - 
==================================================
[2025-08-07 17:07:07,525][src.training.trainer][INFO] - Epoch 18/50
[2025-08-07 17:08:18,148][src.training.trainer][INFO] - Train - Loss: 0.1384, Acc: 0.8891, AUC: 0.9888
[2025-08-07 17:08:18,149][src.training.trainer][INFO] - Val - Loss: 0.1825, Acc: 0.8436, AUC: 0.9754
[2025-08-07 17:08:18,149][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 17:08:18,149][src.training.callbacks][INFO] - Learning rate: 7.16e-05
[2025-08-07 17:08:18,149][src.training.callbacks][INFO] - EarlyStopping: No improvement for 1 epochs
[2025-08-07 17:08:18,149][src.training.trainer][INFO] - 
==================================================
[2025-08-07 17:08:18,149][src.training.trainer][INFO] - Epoch 19/50
[2025-08-07 17:09:28,781][src.training.trainer][INFO] - Train - Loss: 0.1323, Acc: 0.8990, AUC: 0.9904
[2025-08-07 17:09:28,781][src.training.trainer][INFO] - Val - Loss: 0.1882, Acc: 0.8570, AUC: 0.9781
[2025-08-07 17:09:28,781][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 17:09:28,781][src.training.callbacks][INFO] - Learning rate: 6.87e-05
[2025-08-07 17:09:28,781][src.training.callbacks][INFO] - EarlyStopping: New best score = 0.9781
[2025-08-07 17:09:28,781][src.training.trainer][INFO] - New best validation AUC: 0.9781
[2025-08-07 17:09:28,781][src.training.trainer][INFO] - 
==================================================
[2025-08-07 17:09:28,781][src.training.trainer][INFO] - Epoch 20/50
[2025-08-07 17:10:39,597][src.training.trainer][INFO] - Train - Loss: 0.1166, Acc: 0.9034, AUC: 0.9920
[2025-08-07 17:10:39,597][src.training.trainer][INFO] - Val - Loss: 0.2232, Acc: 0.7891, AUC: 0.9754
[2025-08-07 17:10:39,597][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 17:10:39,597][src.training.callbacks][INFO] - Learning rate: 6.58e-05
[2025-08-07 17:10:39,597][src.training.callbacks][INFO] - EarlyStopping: No improvement for 1 epochs
[2025-08-07 17:10:39,597][src.training.trainer][INFO] - 
==================================================
[2025-08-07 17:10:39,597][src.training.trainer][INFO] - Epoch 21/50
[2025-08-07 17:11:49,963][src.training.trainer][INFO] - Train - Loss: 0.1240, Acc: 0.9023, AUC: 0.9912
[2025-08-07 17:11:49,964][src.training.trainer][INFO] - Val - Loss: 0.1956, Acc: 0.8663, AUC: 0.9765
[2025-08-07 17:11:49,964][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 17:11:49,964][src.training.callbacks][INFO] - Learning rate: 6.28e-05
[2025-08-07 17:11:49,964][src.training.callbacks][INFO] - EarlyStopping: No improvement for 2 epochs
[2025-08-07 17:11:49,964][src.training.trainer][INFO] - 
==================================================
[2025-08-07 17:11:49,964][src.training.trainer][INFO] - Epoch 22/50
[2025-08-07 17:13:00,650][src.training.trainer][INFO] - Train - Loss: 0.1070, Acc: 0.9132, AUC: 0.9928
[2025-08-07 17:13:00,650][src.training.trainer][INFO] - Val - Loss: 0.2006, Acc: 0.8317, AUC: 0.9750
[2025-08-07 17:13:00,650][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 17:13:00,650][src.training.callbacks][INFO] - Learning rate: 5.98e-05
[2025-08-07 17:13:00,650][src.training.callbacks][INFO] - EarlyStopping: No improvement for 3 epochs
[2025-08-07 17:13:00,650][src.training.trainer][INFO] - 
==================================================
[2025-08-07 17:13:00,650][src.training.trainer][INFO] - Epoch 23/50
[2025-08-07 17:14:11,724][src.training.trainer][INFO] - Train - Loss: 0.1125, Acc: 0.9081, AUC: 0.9923
[2025-08-07 17:14:11,725][src.training.trainer][INFO] - Val - Loss: 0.1831, Acc: 0.8503, AUC: 0.9770
[2025-08-07 17:14:11,725][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 17:14:11,725][src.training.callbacks][INFO] - Learning rate: 5.67e-05
[2025-08-07 17:14:11,725][src.training.callbacks][INFO] - EarlyStopping: No improvement for 4 epochs
[2025-08-07 17:14:11,725][src.training.trainer][INFO] - 
==================================================
[2025-08-07 17:14:11,725][src.training.trainer][INFO] - Epoch 24/50
[2025-08-07 17:15:22,441][src.training.trainer][INFO] - Train - Loss: 0.1137, Acc: 0.9100, AUC: 0.9925
[2025-08-07 17:15:22,441][src.training.trainer][INFO] - Val - Loss: 0.1760, Acc: 0.8663, AUC: 0.9788
[2025-08-07 17:15:22,441][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 17:15:22,441][src.training.callbacks][INFO] - Learning rate: 5.36e-05
[2025-08-07 17:15:22,441][src.training.callbacks][INFO] - EarlyStopping: New best score = 0.9788
[2025-08-07 17:15:22,441][src.training.trainer][INFO] - New best validation AUC: 0.9788
[2025-08-07 17:15:22,441][src.training.trainer][INFO] - 
==================================================
[2025-08-07 17:15:22,441][src.training.trainer][INFO] - Epoch 25/50
[2025-08-07 17:16:33,232][src.training.trainer][INFO] - Train - Loss: 0.0985, Acc: 0.9201, AUC: 0.9941
[2025-08-07 17:16:33,232][src.training.trainer][INFO] - Val - Loss: 0.2032, Acc: 0.8516, AUC: 0.9773
[2025-08-07 17:16:33,232][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 17:16:33,232][src.training.callbacks][INFO] - Learning rate: 5.05e-05
[2025-08-07 17:16:33,232][src.training.callbacks][INFO] - EarlyStopping: No improvement for 1 epochs
[2025-08-07 17:16:33,232][src.training.trainer][INFO] - 
==================================================
[2025-08-07 17:16:33,232][src.training.trainer][INFO] - Epoch 26/50
[2025-08-07 17:17:44,091][src.training.trainer][INFO] - Train - Loss: 0.0933, Acc: 0.9207, AUC: 0.9944
[2025-08-07 17:17:44,092][src.training.trainer][INFO] - Val - Loss: 0.1957, Acc: 0.8576, AUC: 0.9734
[2025-08-07 17:17:44,092][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 17:17:44,092][src.training.callbacks][INFO] - Learning rate: 4.74e-05
[2025-08-07 17:17:44,092][src.training.callbacks][INFO] - EarlyStopping: No improvement for 2 epochs
[2025-08-07 17:17:44,092][src.training.trainer][INFO] - 
==================================================
[2025-08-07 17:17:44,092][src.training.trainer][INFO] - Epoch 27/50
[2025-08-07 17:18:55,031][src.training.trainer][INFO] - Train - Loss: 0.0906, Acc: 0.9218, AUC: 0.9948
[2025-08-07 17:18:55,031][src.training.trainer][INFO] - Val - Loss: 0.1969, Acc: 0.8623, AUC: 0.9738
[2025-08-07 17:18:55,031][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 17:18:55,031][src.training.callbacks][INFO] - Learning rate: 4.43e-05
[2025-08-07 17:18:55,031][src.training.callbacks][INFO] - EarlyStopping: No improvement for 3 epochs
[2025-08-07 17:18:55,031][src.training.trainer][INFO] - 
==================================================
[2025-08-07 17:18:55,031][src.training.trainer][INFO] - Epoch 28/50
[2025-08-07 17:20:05,888][src.training.trainer][INFO] - Train - Loss: 0.0953, Acc: 0.9234, AUC: 0.9940
[2025-08-07 17:20:05,889][src.training.trainer][INFO] - Val - Loss: 0.1905, Acc: 0.8716, AUC: 0.9773
[2025-08-07 17:20:05,889][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 17:20:05,889][src.training.callbacks][INFO] - Learning rate: 4.12e-05
[2025-08-07 17:20:05,889][src.training.callbacks][INFO] - EarlyStopping: No improvement for 4 epochs
[2025-08-07 17:20:05,889][src.training.trainer][INFO] - 
==================================================
[2025-08-07 17:20:05,889][src.training.trainer][INFO] - Epoch 29/50
[2025-08-07 17:21:16,605][src.training.trainer][INFO] - Train - Loss: 0.0873, Acc: 0.9229, AUC: 0.9951
[2025-08-07 17:21:16,610][src.training.trainer][INFO] - Val - Loss: 0.2020, Acc: 0.8643, AUC: 0.9768
[2025-08-07 17:21:16,610][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 17:21:16,610][src.training.callbacks][INFO] - Learning rate: 3.82e-05
[2025-08-07 17:21:16,610][src.training.callbacks][INFO] - EarlyStopping: No improvement for 5 epochs
[2025-08-07 17:21:16,610][src.training.trainer][INFO] - 
==================================================
[2025-08-07 17:21:16,610][src.training.trainer][INFO] - Epoch 30/50
[2025-08-07 17:22:27,185][src.training.trainer][INFO] - Train - Loss: 0.0938, Acc: 0.9249, AUC: 0.9948
[2025-08-07 17:22:27,186][src.training.trainer][INFO] - Val - Loss: 0.2043, Acc: 0.8756, AUC: 0.9756
[2025-08-07 17:22:27,186][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 17:22:27,186][src.training.callbacks][INFO] - Learning rate: 3.52e-05
[2025-08-07 17:22:27,186][src.training.callbacks][INFO] - EarlyStopping: No improvement for 6 epochs
[2025-08-07 17:22:27,186][src.training.trainer][INFO] - 
==================================================
[2025-08-07 17:22:27,186][src.training.trainer][INFO] - Epoch 31/50
[2025-08-07 17:23:39,791][src.training.trainer][INFO] - Train - Loss: 0.0840, Acc: 0.9342, AUC: 0.9955
[2025-08-07 17:23:39,792][src.training.trainer][INFO] - Val - Loss: 0.2030, Acc: 0.8709, AUC: 0.9774
[2025-08-07 17:23:39,792][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 17:23:39,792][src.training.callbacks][INFO] - Learning rate: 3.23e-05
[2025-08-07 17:23:39,792][src.training.callbacks][INFO] - EarlyStopping: No improvement for 7 epochs
[2025-08-07 17:23:39,792][src.training.trainer][INFO] - 
==================================================
[2025-08-07 17:23:39,792][src.training.trainer][INFO] - Epoch 32/50
[2025-08-07 17:24:52,803][src.training.trainer][INFO] - Train - Loss: 0.0869, Acc: 0.9311, AUC: 0.9954
[2025-08-07 17:24:52,803][src.training.trainer][INFO] - Val - Loss: 0.2133, Acc: 0.8829, AUC: 0.9779
[2025-08-07 17:24:52,803][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 17:24:52,803][src.training.callbacks][INFO] - Learning rate: 2.94e-05
[2025-08-07 17:24:52,804][src.training.callbacks][INFO] - EarlyStopping: No improvement for 8 epochs
[2025-08-07 17:24:52,804][src.training.trainer][INFO] - 
==================================================
[2025-08-07 17:24:52,804][src.training.trainer][INFO] - Epoch 33/50
[2025-08-07 17:26:06,240][src.training.trainer][INFO] - Train - Loss: 0.0810, Acc: 0.9338, AUC: 0.9958
[2025-08-07 17:26:06,240][src.training.trainer][INFO] - Val - Loss: 0.2027, Acc: 0.8723, AUC: 0.9768
[2025-08-07 17:26:06,240][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 17:26:06,241][src.training.callbacks][INFO] - Learning rate: 2.67e-05
[2025-08-07 17:26:06,241][src.training.callbacks][INFO] - EarlyStopping: No improvement for 9 epochs
[2025-08-07 17:26:06,241][src.training.trainer][INFO] - 
==================================================
[2025-08-07 17:26:06,241][src.training.trainer][INFO] - Epoch 34/50
[2025-08-07 17:27:18,485][src.training.trainer][INFO] - Train - Loss: 0.0759, Acc: 0.9366, AUC: 0.9962
[2025-08-07 17:27:18,485][src.training.trainer][INFO] - Val - Loss: 0.2100, Acc: 0.8816, AUC: 0.9781
[2025-08-07 17:27:18,485][src.training.callbacks][WARNING] - Metric 'val_auc_macro' not found in metrics
[2025-08-07 17:27:18,485][src.training.callbacks][INFO] - Learning rate: 2.40e-05
[2025-08-07 17:27:18,485][src.training.callbacks][INFO] - EarlyStopping: No improvement for 10 epochs
[2025-08-07 17:27:18,485][src.training.callbacks][INFO] - EarlyStopping: Stopping training after 10 epochs without improvement
[2025-08-07 17:27:18,485][src.training.trainer][INFO] - Early stopping triggered!
[2025-08-07 17:27:18,490][src.training.callbacks][INFO] - Saved metrics to checkpoints/training_metrics.json
[2025-08-07 17:27:18,490][src.training.trainer][INFO] - Training completed! Best validation AUC: 0.9788
[2025-08-07 17:27:18,490][training][INFO] - Running test evaluation...
[2025-08-07 17:27:18,490][src.training.trainer][INFO] - Running test evaluation...
[2025-08-07 17:27:24,731][src.training.trainer][INFO] - 
Test Classification Report:
[2025-08-07 17:27:24,734][src.training.trainer][INFO] -               precision    recall  f1-score   support

       akiec     0.8571    0.7347    0.7912        49
         bcc     0.8800    0.8571    0.8684        77
         bkl     0.8050    0.7758    0.7901       165
          df     1.0000    0.8824    0.9375        17
         mel     0.6223    0.7006    0.6592       167
          nv     0.9321    0.9274    0.9297      1006
        vasc     0.8696    0.9091    0.8889        22

    accuracy                         0.8749      1503
   macro avg     0.8523    0.8267    0.8379      1503
weighted avg     0.8785    0.8749    0.8762      1503

[2025-08-07 17:27:24,734][src.training.trainer][INFO] - 
Test Metrics:
[2025-08-07 17:27:24,734][src.training.trainer][INFO] -   Accuracy: 0.8749
[2025-08-07 17:27:24,734][src.training.trainer][INFO] -   Balanced Accuracy: 0.8267
[2025-08-07 17:27:24,734][src.training.trainer][INFO] -   AUC-ROC: 0.9758
[2025-08-07 17:27:24,734][src.training.trainer][INFO] -   Sensitivity: 0.8267
[2025-08-07 17:27:24,734][src.training.trainer][INFO] -   Specificity: 0.9678
[2025-08-07 17:27:24,734][training][INFO] - ==================================================
[2025-08-07 17:27:24,734][training][INFO] - Training completed!
[2025-08-07 17:27:24,734][training][INFO] - Best validation AUC: 0.9788
[2025-08-07 17:27:24,735][training][INFO] - Test AUC: 0.9758
[2025-08-07 17:27:24,735][training][INFO] - Test Accuracy: 0.8749
[2025-08-07 17:27:24,735][training][INFO] - Test Balanced Accuracy: 0.8267
[2025-08-07 17:27:24,735][training][INFO] - ✓ AUC target met: 0.9758 >= 0.9
[2025-08-07 17:27:24,735][training][INFO] - ✓ Accuracy target met: 0.8749 >= 0.85
